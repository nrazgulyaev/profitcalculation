<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arconic · Villa Revenue & Asset Split</title>
  <meta name="description" content="Arconic — калькулятор распределения выручки и активов проекта вилл" />
  <!-- React 18 + Babel (для JSX без сборщика) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html, body, #root {
      height: 100%;
      margin: 0;
      font-family: 'Arial', sans-serif;
    }
    body {
      background: #f9fafb;
      color: #111827;
    }
    .app-container {
      padding: 20px;
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-top: 20px;
    }
    .form-container {
      margin-bottom: 30px;
    }
    .input-field {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .button {
      width: 100%;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .button:hover {
      background-color: #45a049;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    .card-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .row {
      display: flex;
      gap: 20px;
    }
    .column {
      flex: 1;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    function App() {
      const [villaTypes, setVillaTypes] = useState([
        { id: 1, name: "Вилла тип 1", area: 142.7, count: 6 },
        { id: 2, name: "Вилла тип 2", area: 192, count: 2 },
        { id: 3, name: "Вилла тип 3", area: 201, count: 1 },
      ]);

      const [investorExpenses, setInvestorExpenses] = useState([]);
      const [totalExpenses, setTotalExpenses] = useState([]);
      const [interestRate, setInterestRate] = useState(8.33); // Целевая доходность
      const [totalSpent, setTotalSpent] = useState(0); // Общая потраченная сумма

      // Функция для добавления затрат инвестора
      const handleInvestorExpenseChange = (month, amount, year) => {
        setInvestorExpenses((prev) => [...prev, { month, amount: parseFloat(amount), year }]);
        setTotalSpent((prev) => prev + parseFloat(amount));
      };

      // Функция для добавления общих затрат
      const handleTotalExpenseChange = (month, amount, year) => {
        setTotalExpenses((prev) => [...prev, { month, amount: parseFloat(amount), year }]);
      };

      // Компонент для ввода данных о типах вилл
      const VillaTypesForm = () => {
        const handleVillaChange = (index, field, value) => {
          const newVillaTypes = [...villaTypes];
          newVillaTypes[index][field] = value;
          setVillaTypes(newVillaTypes);
        };

        return (
          <div className="card">
            <h2 className="card-title">Типы вилл</h2>
            {villaTypes.map((villa, index) => (
              <div key={index} className="row">
                <div className="column">
                  <label>Название виллы:</label>
                  <input
                    className="input-field"
                    value={villa.name}
                    onChange={(e) => handleVillaChange(index, "name", e.target.value)}
                  />
                </div>
                <div className="column">
                  <label>Площадь (м²):</label>
                  <input
                    className="input-field"
                    type="number"
                    value={villa.area}
                    onChange={(e) => handleVillaChange(index, "area", e.target.value)}
                  />
                </div>
                <div className="column">
                  <label>Количество:</label>
                  <input
                    className="input-field"
                    type="number"
                    value={villa.count}
                    onChange={(e) => handleVillaChange(index, "count", e.target.value)}
                  />
                </div>
              </div>
            ))}
          </div>
        );
      };

      // Компонент для ввода данных о расходах
      const ExpenseForm = () => {
        const [month, setMonth] = useState("");
        const [amount, setAmount] = useState(0);
        const [year, setYear] = useState(new Date().getFullYear());

        const handleSubmitInvestorExpense = (e) => {
          e.preventDefault();
          if (month && amount && year) {
            handleInvestorExpenseChange(month, amount, year);
            setMonth("");
            setAmount(0);
          }
        };

        const handleSubmitTotalExpense = (e) => {
          e.preventDefault();
          if (month && amount && year) {
            handleTotalExpenseChange(month, amount, year);
            setMonth("");
            setAmount(0);
          }
        };

        return (
          <div className="card">
            <h2 className="card-title">Ввод затрат</h2>

            <h3>Затраты инвестора</h3>
            <form onSubmit={handleSubmitInvestorExpense}>
              <input
                type="text"
                placeholder="Месяц"
                value={month}
                onChange={(e) => setMonth(e.target.value)}
                className="input-field"
              />
              <input
                type="number"
                placeholder="Сумма"
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
                className="input-field"
              />
              <input
                type="number"
                placeholder="Год"
                value={year}
                onChange={(e) => setYear(e.target.value)}
                className="input-field"
              />
              <button type="submit" className="button">Добавить расходы инвестора</button>
            </form>

            <h3>Общие затраты по проекту</h3>
            <form onSubmit={handleSubmitTotalExpense}>
              <input
                type="text"
                placeholder="Месяц"
                value={month}
                onChange={(e) => setMonth(e.target.value)}
                className="input-field"
              />
              <input
                type="number"
                placeholder="Сумма"
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
                className="input-field"
              />
              <input
                type="number"
                placeholder="Год"
                value={year}
                onChange={(e) => setYear(e.target.value)}
                className="input-field"
              />
              <button type="submit" className="button">Добавить общие затраты</button>
            </form>

            <h3>Целевая доходность (%)</h3>
            <input
              type="number"
              value={interestRate}
              onChange={(e) => setInterestRate(e.target.value)}
              className="input-field"
            />
          </div>
        );
      };

      // Компонент для расчетов
      const VillaCalculation = () => {
        const totalArea = villaTypes.reduce((total, villa) => total + villa.area * villa.count, 0);
        const totalCost = totalArea * 1200; // Себестоимость квадратного метра

        const priceAt100 = totalCost + (totalCost * interestRate / 100);

        return (
          <div className="card">
            <h2 className="card-title">Резюме проекта</h2>
            <p>Общие расходы на проект: ${totalCost}</p>
            <p>Общая площадь всех вилл: {totalArea} м²</p>
            <h3>Стоимость виллы</h3>
            <p>Цена 1 м²: ${priceAt100}</p>
          </div>
        );
      };

      return (
        <div className="app-container">
          <h1>Расчет стоимости виллы</h1>
          <ExpenseForm />
          <VillaTypesForm />
          <VillaCalculation />
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
