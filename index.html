<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arconic · Villa Revenue & Asset Split</title>
  <meta name="description" content="Arconic — калькулятор распределения выручки и активов проекта вилл" />
  <!-- React 18 + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html, body, #root {
      height: 100%;
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: #f9fafb;
    }
    .app-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      margin-top: 20px;
    }
    .form-container {
      margin-bottom: 30px;
    }
    .input-field {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      width: 100%;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .button-danger {
      background-color: #e74c3c;
      color: white;
    }
    .button-danger:hover {
      background-color: #c0392b;
    }
    .button-add {
      background-color: #e0e0e0;
      color: #111827;
    }
    .button-add:hover {
      background-color: #d4d4d4;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    .card-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .row {
      display: flex;
      gap: 20px;
    }
    .column {
      flex: 1;
    }
    .type-villa {
      margin-bottom: 20px;
    }
    .table-wrap {
      max-height: 260px;
      overflow: auto;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .table th, .table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo } = React;

    function App() {
      // Состояния для типов вилл, затрат и доходности
      const [villaTypes, setVillaTypes] = useState([
        { id: 1, name: "Вилла тип 1", area: 142.7, count: 6 },
        { id: 2, name: "Вилла тип 2", area: 192, count: 2 },
        { id: 3, name: "Вилла тип 3", area: 201, count: 1 },
      ]);
      
      const [investorExpenses, setInvestorExpenses] = useState([]);
      const [totalExpenses, setTotalExpenses] = useState([]);
      const [interestRate, setInterestRate] = useState(8.33); // Целевая доходность в годовых
      const [baseCostPerM2, setBaseCostPerM2] = useState(1200); // Себестоимость квадратного метра

      // Добавление нового типа виллы
      const addVillaType = () => {
        const newId = Math.max(...villaTypes.map(villa => villa.id)) + 1;
        setVillaTypes([
          ...villaTypes,
          { id: newId, name: `Вилла тип ${newId}`, area: 100, count: 1 },
        ]);
      };

      // Удаление типа виллы
      const removeVillaType = (id) => {
        setVillaTypes(villaTypes.filter(villa => villa.id !== id));
      };

      // Добавление затрат инвестора
      const addInvestorExpense = (month, year, amount) => {
        setInvestorExpenses([...investorExpenses, { month, year, amount: parseFloat(amount) }]);
      };

      // Добавление общих затрат
      const addTotalExpense = (month, year, amount) => {
        setTotalExpenses([...totalExpenses, { month, year, amount: parseFloat(amount) }]);
      };

      // Вычисление общей площади всех вилл
      const totalArea = useMemo(() => villaTypes.reduce((sum, villa) => sum + (villa.area * villa.count), 0), [villaTypes]);

      // Вычисление стоимости квадратного метра с учетом доходности
      const calculatePricePerSquareMeter = () => {
        const totalInvested = investorExpenses.reduce((sum, expense) => sum + expense.amount, 0);
        const profit = totalInvested * (interestRate / 100);
        return baseCostPerM2 + (profit / totalArea);
      };

      return (
        <div className="app-container">
          <h1>Расчет стоимости виллы</h1>

          {/* Форма для ввода типов вилл */}
          <div className="card">
            <h2 className="card-title">Типы вилл</h2>
            {villaTypes.map((villa, index) => (
              <div key={villa.id} className="type-villa">
                <label>Название виллы:</label>
                <input
                  className="input-field"
                  value={villa.name}
                  onChange={(e) => {
                    const updatedVillaTypes = [...villaTypes];
                    updatedVillaTypes[index].name = e.target.value;
                    setVillaTypes(updatedVillaTypes);
                  }}
                />
                <label>Площадь (м²):</label>
                <input
                  className="input-field"
                  type="number"
                  value={villa.area}
                  onChange={(e) => {
                    const updatedVillaTypes = [...villaTypes];
                    updatedVillaTypes[index].area = e.target.value;
                    setVillaTypes(updatedVillaTypes);
                  }}
                />
                <label>Количество:</label>
                <input
                  className="input-field"
                  type="number"
                  value={villa.count}
                  onChange={(e) => {
                    const updatedVillaTypes = [...villaTypes];
                    updatedVillaTypes[index].count = e.target.value;
                    setVillaTypes(updatedVillaTypes);
                  }}
                />
                <button
                  className="button button-danger"
                  onClick={() => removeVillaType(villa.id)}
                >
                  Удалить
                </button>
              </div>
            ))}
            <button className="button button-add" onClick={addVillaType}>+ Добавить тип виллы</button>
          </div>

          {/* Форма для ввода затрат инвестора */}
          <div className="card">
            <h2 className="card-title">Затраты инвестора</h2>
            <div className="row">
              <select className="select">
                <option value="">Выберите месяц</option>
                {["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"].map((month, index) => (
                  <option key={index} value={month}>{month}</option>
                ))}
              </select>
              <input
                className="input-field"
                type="number"
                placeholder="Сумма"
              />
              <select className="select">
                <option value="">Выберите год</option>
                {[2024, 2025, 2026].map(year => (
                  <option key={year} value={year}>{year}</option>
                ))}
              </select>
            </div>
            <button
              className="button"
              onClick={() => {
                // Логика добавления затрат
              }}
            >
              Добавить затраты инвестора
            </button>
          </div>

          {/* Форма для ввода общих затрат */}
          <div className="card">
            <h2 className="card-title">Общие затраты</h2>
            <div className="row">
              <select className="select">
                <option value="">Выберите месяц</option>
                {["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"].map((month, index) => (
                  <option key={index} value={month}>{month}</option>
                ))}
              </select>
              <input
                className="input-field"
                type="number"
                placeholder="Сумма"
              />
              <select className="select">
                <option value="">Выберите год</option>
                {[2024, 2025, 2026].map(year => (
                  <option key={year} value={year}>{year}</option>
                ))}
              </select>
            </div>
            <button
              className="button"
              onClick={() => {
                // Логика добавления общих затрат
              }}
            >
              Добавить общие затраты
            </button>
          </div>

          {/* Рассчитанная стоимость квадратного метра */}
          <div className="card">
            <h2 className="card-title">Результат расчета</h2>
            <p>Общая площадь всех вилл: {totalArea} м²</p>
            <p>Цена за 1 м²: ${calculatePricePerSquareMeter().toFixed(2)}</p>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
