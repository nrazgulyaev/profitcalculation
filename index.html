<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arconic · Villa Revenue & Asset Split</title>
  <meta name="description" content="Arconic — калькулятор распределения выручки и активов проекта вилл" />
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html, body, #root { height: 100%; margin: 0; font-family: 'Inter', system-ui, sans-serif; }
    .container { padding: 20px; }

    /* Основной стиль */
    .container { padding: 16px; background: #f9fafb; min-height: 100vh; color: #111827; }
    .input, .select, .btn { padding: 10px 14px; margin: 5px 0; border-radius: 8px; }
    .input, .select { border: 1px solid #d1d5db; background: #fff; width: 100%; }
    .btn { background: #4CAF50; color: white; border: none; cursor: pointer; }
    .btn:hover { background: #45a049; }
    .table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    .table th { background-color: #f3f4f6; }
    .table td { background-color: #fff; }

    .toolbar { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }
    .toolbarItem { display: flex; flex-direction: column; width: 200px; }
    .toolbarItem label { font-weight: bold; margin-bottom: 8px; }
    .toolbarItemMuted { color: #6b7280; font-size: 12px; }

    .header { background: #fff; padding: 16px 0; display: flex; justify-content: space-between; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
    .logoText { font-weight: 800; font-size: 18px; color: #374151; }
    .headerRight { display: flex; gap: 10px; align-items: center; }

    .footer { text-align: center; font-size: 12px; color: #6b7280; margin-top: 32px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo } = React;

    function VillaRevenueSplitApp() {
      // -------- ИСХОДНЫЕ ДАННЫЕ --------
      const [types, setTypes] = useState([
        { id: 1, name: "Вилла тип 1", area: 142.7, count: 6 },
        { id: 2, name: "Вилла тип 2", area: 192, count: 2 },
        { id: 3, name: "Вилла тип 3", area: 201, count: 1 }
      ]);
      const [basePrice, setBasePrice] = useState(2400);
      const [growthRate, setGrowthRate] = useState(10); // 10% годовых
      const [costPerM2, setCostPerM2] = useState(1200);
      const [investorInvestPct, setInvestorInvestPct] = useState(90);
      const [investorProfitPct, setInvestorProfitPct] = useState(45);

      // Данные затрат
      const [expenses, setExpenses] = useState([
        { month: 'Апрель 2024', amount: 47185 },
        { month: 'Май 2024', amount: 9254 },
        { month: 'Июнь 2024', amount: 0 },
        { month: 'Июль 2024', amount: 0 }
      ]);

      // Расчет доходности
      const calcGrowth = (amount) => (amount * (growthRate / 100));

      const totalArea = useMemo(() => types.reduce((sum, type) => sum + type.area * type.count, 0), [types]);
      const totalCost = useMemo(() => totalArea * costPerM2, [totalArea, costPerM2]);

      const calculateResults = () => {
        let totalExpenses = 0;
        let cumulativeGrowth = 0;
        const results = expenses.map((expense, index) => {
          totalExpenses += expense.amount;
          const growth = calcGrowth(totalExpenses);
          cumulativeGrowth += growth;
          const markupPerM2 = cumulativeGrowth / totalArea;
          const marketPrice = basePrice + markupPerM2;

          return {
            month: expense.month,
            expenses: totalExpenses,
            growth,
            markupPerM2,
            marketPrice
          };
        });
        return results;
      };

      const results = calculateResults();

      return (
        <div className="container">
          <div className="header">
            <div className="logoText">Arconic · Villa Revenue & Asset Split</div>
            <div className="headerRight">
              <input 
                type="number" 
                className="input" 
                value={basePrice} 
                onChange={(e) => setBasePrice(Number(e.target.value))} 
                placeholder="Базовая цена за м²"
              />
              <input 
                type="number" 
                className="input" 
                value={growthRate} 
                onChange={(e) => setGrowthRate(Number(e.target.value))} 
                placeholder="Целевая доходность (%)"
              />
            </div>
          </div>

          <div className="toolbar">
            <div className="toolbarItem">
              <label>Типы вилл</label>
              {types.map((type, index) => (
                <div key={type.id} style={{ marginBottom: 8 }}>
                  <input 
                    className="input"
                    type="text" 
                    value={type.name} 
                    onChange={(e) => {
                      const updatedTypes = [...types];
                      updatedTypes[index].name = e.target.value;
                      setTypes(updatedTypes);
                    }}
                    placeholder="Название виллы"
                  />
                  <input 
                    className="input"
                    type="number" 
                    value={type.area} 
                    onChange={(e) => {
                      const updatedTypes = [...types];
                      updatedTypes[index].area = Number(e.target.value);
                      setTypes(updatedTypes);
                    }}
                    placeholder="Площадь"
                  />
                  <input 
                    className="input"
                    type="number" 
                    value={type.count} 
                    onChange={(e) => {
                      const updatedTypes = [...types];
                      updatedTypes[index].count = Number(e.target.value);
                      setTypes(updatedTypes);
                    }}
                    placeholder="Количество"
                  />
                </div>
              ))}
            </div>
            <button className="btn" onClick={() => setTypes([...types, { id: types.length + 1, name: "", area: 100, count: 1 }])}>+ Добавить тип виллы</button>
          </div>

          <div className="toolbar">
            <div className="toolbarItem">
              <label>Ежемесячные затраты</label>
              {expenses.map((expense, index) => (
                <div key={index} style={{ marginBottom: 8 }}>
                  <input 
                    className="input"
                    type="text" 
                    value={expense.month} 
                    onChange={(e) => {
                      const updatedExpenses = [...expenses];
                      updatedExpenses[index].month = e.target.value;
                      setExpenses(updatedExpenses);
                    }} 
                    placeholder="Месяц и год"
                  />
                  <input 
                    className="input"
                    type="number" 
                    value={expense.amount} 
                    onChange={(e) => {
                      const updatedExpenses = [...expenses];
                      updatedExpenses[index].amount = Number(e.target.value);
                      setExpenses(updatedExpenses);
                    }} 
                    placeholder="Сумма"
                  />
                </div>
              ))}
            </div>
            <button className="btn" onClick={() => setExpenses([...expenses, { month: "", amount: 0 }])}>+ Добавить расходы</button>
          </div>

          <div className="table">
            <h3>Результаты расчета</h3>
            <table className="table">
              <thead>
                <tr>
                  <th>Месяц</th>
                  <th>Затраты</th>
                  <th>Доходность</th>
                  <th>Наценка на 1 м²</th>
                  <th>Рыночная цена</th>
                </tr>
              </thead>
              <tbody>
                {results.map((result, index) => (
                  <tr key={index}>
                    <td>{result.month}</td>
                    <td>{result.expenses.toLocaleString()}</td>
                    <td>{result.growth.toLocaleString()}</td>
                    <td>{result.markupPerM2.toLocaleString()}</td>
                    <td>{result.marketPrice.toLocaleString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

        </div>
      );
    }

    // Рендерим приложение
    ReactDOM.createRoot(document.getElementById("root")).render(<VillaRevenueSplitApp />);
  </script>
</body>
</html>
